function buildUniqueId(t){var n=[];n.push(DeviceUtil.getAdvertisingId()),n.push(DeviceUtil.getAndroidId()),Promise.all(n).then(n=>{let e=n[0];let i=n[1];StorageUtil.putData(constants.MOBILE_ADVERTISING_ID,e);StorageUtil.putData(constants.MOBILE_ANDROID_ID,i);StorageUtil.putData("umeng_uniqueid",i||e);t(i?i:e)})}function MD5(t){return md5(t)}function encode(t){return Base64.encode(t,!1)}function checkEmptyArgument(t){return!(!t.length||!this.checkId(t[0]))}function checkId(t){return!(!t||"string"!=typeof t)}function toString(t){var n="";if(t)try{n=JSON.stringify(t)}catch(t){}return n}function stringToArray(t){if(t)try{return JSON.parse(t)}catch(t){}return[]}function toObject(t){if(t)try{return JSON.parse(t)}catch(t){}return null}function checkAttr(t){return!(!t||"string"!=typeof t)||"object"==typeof t&&!isArray(t)}function isArray(t){return"[object Array]"==Object.prototype.toString.call(t)}function Looper(){}function send(t){network.getType({success:function(n){"none"!=n.type&&hasEnvelope(t,function(n,e){if(n){if(e){const n={md5Key:e,type:"second"};RequestHelper.getInstance().send(n,function(){StoreQueue.getInstance().handleMessage(null),realSend(t)})}}else realSend(t)})},fail:function(t){}})}function hasEnvelope(t,n){StorageUtil.getData(constants.KEY_NO_SEND_REQUEST_KEYS,function(e){if(!e)return void n(!1,null);const i=UmengUtils.stringToArray(e);if(!i||0===i.length)return void n(!1,null);for(var o in i){var s=i[o];if(s){if(0===s.indexOf(constants.KEY_EVENT_PREFIX)&&t===constants.REQUEST_TYPE_EVENT)return void n(!0,s);if(0===s.indexOf(constants.KEY_HALF_SESSION_PREFIX)&&t===constants.REQUEST_TYPE_SESSION_HALF)return void n(!0,s);if(0===s.indexOf(constants.KEY_CLOSE_SESSION_PREFIX)&&t===constants.REQUEST_TYPE_SESSION_CLOSE)return void n(!0,s)}}n(!1,null)})}function realSend(t){if(RequestHelper.getInstance().paramsIsValid(t))if(t===constants.REQUEST_TYPE_SESSION_HALF)(e=(n=RequestHelper.getInstance().buildSendContent(t,null)).data).analytics&&RequestHelper.getInstance().send(n,function(t){t&&-1!=t.indexOf(constants.KEY_HALF_SESSION_PREFIX)&&(Header.getInstance().setFirstSendFlag(),StorageUtil.putData(constants.APP_FIRST_OPEN_FLAG,"false"))});else if(t===constants.REQUEST_TYPE_SESSION_CLOSE){var n=RequestHelper.getInstance().buildSendContent(t,null);if(n&&n.data){var e=n.data;e.analytics&&RequestHelper.getInstance().send(n)}}else t===constants.REQUEST_TYPE_EVENT&&EventStoreQueue.getInstance().readEkvDatas(function(n){if(n&&0!==n.length){var e=RequestHelper.getInstance().buildSendContent(t,n);e.data.analytics&&RequestHelper.getInstance().send(e)}})}function PageController(){this._pagelist=[],this._currentPage={},this.pageObject={}}function UmengAnalysisLib(){this.pageController=new PageController}function isInit(){return!!inited||(console.error("[app.ux] ==> onCreate not invoked init() method"),!1)}function sendDatas(){Header.getInstance().getHeader()?(Request.send(constants.REQUEST_TYPE_SESSION_HALF),Request.send(constants.REQUEST_TYPE_SESSION_CLOSE),Request.send(constants.REQUEST_TYPE_EVENT)):setTimeout(sendDatas,100)}function Page(t){if(t){const n=t.onShow;t.onShow=function(){try{UmengAnalysis.resume(this)}catch(t){}if(n)return n.apply(this,arguments)}}if(t){const n=t.onHide;t.onHide=function(){try{UmengAnalysis.pause(this)}catch(t){}if(n)return n.apply(this,arguments)}}return t}import storage from"@system.storage";import md5 from"md5";import{Base64}from"js-base64";import App from"@system.app";import fetch from"@system.fetch";import network from"@system.network";const StorageUtil={putData(t,n,e,i){storage.set({key:t,value:n,success:function(t){e&&e(t)},fail:function(t,n){i&&i(t,n)}})},getData(t,n,e){storage.get({key:t,success:function(t){n&&n(t)},fail:function(t,n){e&&e(t,n)}})},deleteData(t,n){storage.delete({key:t,success:function(t){n&&n(!0)},fail:function(t,e){n&&n(!1)}})}},constants={KEY_NO_SEND_REQUEST_KEYS:"umeng_key_no_send_request",SESSION_INTERVAL:3e4,TEST_URL:"https://preulogs.umeng.com/unify_logs",RELEASE_URL:"https://ulogs.umeng.com/unify_logs",KEY_SESSION_PREFIX:"umeng_session_prefix_",KEY_EVENT_PREFIX:"umeng_event_prefix_",KEY_HALF_SESSION_PREFIX:"umeng_half_session_prefix_",KEY_CLOSE_SESSION_PREFIX:"umeng_close_session_prefix_",REQUEST_TYPE_SESSION_HALF:1,REQUEST_TYPE_SESSION_CLOSE:2,REQUEST_TYPE_EVENT:3,IS_DEBUG:!1,SDK_VERSION:"1.0.5",APP_FIRST_OPEN_FLAG:"umeng_key_first_open_flag",MOBILE_ADVERTISING_ID:"umeng_mobile_advertising_id",MOBILE_ANDROID_ID:"umeng_android__id"},device=require("@system.device"),network$1=require("@system.network"),router=require("@system.router"),DeviceUtil={getBaseInfo(){return new Promise((t,n)=>{device.getInfo({success:function(n){t(n)},fail:function(n){t(null)}})})},getNetworkInfo(t){network$1.getType({success:function(n){t(n)}})},getAndroidId(){return new Promise((t,n)=>{device.getUserId({success:function(n){t(n.userId)},fail:function(n,e){t("")}})})},getAdvertisingId(){return new Promise((t,n)=>{device.getAdvertisingId({success:function(n){t(n.advertisingId)},fail:function(n,e){t("")}})})},getUniqueId(){return new Promise((t,n)=>{StorageUtil.getData("umeng_uniqueid",function(n){n?t(n):buildUniqueId(t)},function(){buildUniqueId(t)})})},getPageName(){try{return router.getState().name}catch(t){}}},Log={d(t){},i(t){},e(t){},w(t){},v(t){}};var UmengUtils={MD5:MD5,encode:encode,checkEmptyArgument:checkEmptyArgument,checkId:checkId,stringToArray:stringToArray,toString:toString,toObject:toObject,checkAttr:checkAttr};const $JSON_UMENG_SESSIONS$="json_umeng_sessions",$JSON_UMENG_HALF_SESSIONS$="json_umeng_half_session",$JSON_UMENG_CURRENT_SESSION$="json_umeng_current_session",$JSON_UMENG_PAGE_END_TIME$="json_umeng_page_end_time",Session=function(){function t(){return{getCurrentSessionId(){return g},getCurrentSession(){return c},getSessions(){return _},init(t){this.appkey=t,i()},endSession(){c&&(r=Date.now(),c.end_time=r,StorageUtil.putData($JSON_UMENG_CURRENT_SESSION$,UmengUtils.toString(c)),StorageUtil.putData($JSON_UMENG_PAGE_END_TIME$,r))},clearSessions(){StorageUtil.deleteData($JSON_UMENG_SESSIONS$),_.splice(0,_.length),_=[]},setOnSessionListener(t){this.sessionListener=t},getHalfSessions(){return l},clearHalfSession(){StorageUtil.deleteData($JSON_UMENG_HALF_SESSIONS$),l.splice(0,l.length),l=[]}}}function n(t,n){const e=Date.now();DeviceUtil.getUniqueId().then(t=>{const i=UmengUtils.MD5(`${e}:::${Session.getInstance().appkey}:::${t}`);n(i)})}function e(t){var n={};return n.id=t,n.start_time=Date.now(),n}function i(){const t=Date.now();c?r&&t-r>constants.SESSION_INTERVAL&&(o(r),s(c)):StorageUtil.getData($JSON_UMENG_CURRENT_SESSION$,function(n){n&&(c=UmengUtils.toObject(n))?StorageUtil.getData($JSON_UMENG_PAGE_END_TIME$,function(n){n&&t-n>constants.SESSION_INTERVAL?(o(n),s(c)):g=c.id}):s(null)})}function o(t){try{c.end_time=Number.parseInt(t)}catch(n){c.end_time=t}let n=t-c.start_time;c.duration=n}function s(t){const i=t?t.id:"",o=Session.getInstance().sessionListener(i);n(i,function(n){c=e(n),StorageUtil.getData($JSON_UMENG_SESSIONS$,function(e){_=UmengUtils.stringToArray(e),t?o.pages(function(e){e&&e.length>0&&(t.pages=e,t.$page_num=e.length),_.push(t),StorageUtil.putData($JSON_UMENG_SESSIONS$,UmengUtils.toString(_)),a(o,n)}):a(o,n)}),StorageUtil.putData($JSON_UMENG_CURRENT_SESSION$,UmengUtils.toString(c)),g=n})}function a(t,n){StorageUtil.getData($JSON_UMENG_HALF_SESSIONS$,function(e){l=UmengUtils.stringToArray(e),c&&(l.push(c),StorageUtil.putData($JSON_UMENG_HALF_SESSIONS$,UmengUtils.toString(l)),t.generateSessionAfterHandler(n))})}let r,c,u=null,g="",_=[],l=[];return{getInstance(){return u||(u=t()),u}}}(),$JSON_UMENG_HEADER$="json_umeng_header",$UMENG_KEY_IMPRINT$="umeng_key_imprint",MOBILE_NETWORK_2G="2g",MOBILE_NETWORK_3G="3g",MOBILE_NETWORK_4G="4g",MOBILE_NETWORK_NONE="none",BLANK_SPACE=" ",UMENG_ADVERTISTING_ID="idfa",UMENG_ANDROID_ID="android_id",Header=function(){function t(){return{init(t){this.appkey=t,this.appInfo=App.getInfo();const e=this;n(function(t){e.header=t,StorageUtil.putData($JSON_UMENG_HEADER$,UmengUtils.toString(t))})},getHeader(t){switch(t){case constants.REQUEST_TYPE_SESSION_HALF:this.header.st="1",1==a&&delete this.header.atm;break;case constants.REQUEST_TYPE_SESSION_CLOSE:case constants.REQUEST_TYPE_EVENT:delete this.header.st,delete this.header.atm}return this.header},addHeaderAttr(t,n){this.header&&(this.header[`${t}`]=n)},getHeaderAttr(t){return this.header&&this.header.hasOwnProperty(t)?this.header[`${t}`]:null},getPackageName(){try{return this.appInfo.packageName}catch(t){}return""},setFirstSendFlag(){a=!0}}}function n(t){DeviceUtil.getBaseInfo().then(n=>{DeviceUtil.getUniqueId().then(s=>{DeviceUtil.getNetworkInfo(function(a){let r=a.type;r===MOBILE_NETWORK_NONE&&(r="unknown");const c=o(n,s,r);StorageUtil.getData($UMENG_KEY_IMPRINT$,function(n){0!=n.length&&(c.imprint=n),StorageUtil.getData(constants.APP_FIRST_OPEN_FLAG,function(n){"true"===n&&(c.atm="1"),StorageUtil.getData(constants.MOBILE_ADVERTISING_ID,function(n){if(n){let t=e(n);if(t){let n=i(UMENG_ADVERTISTING_ID,t);c.id_tracking=n}}StorageUtil.getData(constants.MOBILE_ANDROID_ID,function(n){if(n){let t=e(n);if(t)if(c.id_tracking&&c.id_tracking.snapshots)c.id_tracking.snapshots[UMENG_ANDROID_ID]=t;else{let n=i(UMENG_ANDROID_ID,t);c.id_tracking=n}}t(c)})})})})})})})}function e(t){if(t){let n={identity:t,version:1,ts:Date.now()};return n}}function i(t,n){let e={snapshots:{}};return e.snapshots[t]=n,e}function o(t,n,e){let i=null;if(t){const e=t.screenWidth,o=t.screenHeight,a=e>o?`${e}*${o}`:`${o}*${e}`,r=s.appInfo;i={app_version:r.versionName,version_code:r.versionCode,device_type:"Phone",package_name:r.packageName,sdk_type:"Android",os:"Android",sdk_version:constants.SDK_VERSION,appkey:s.appkey,device_model:t.model.toLowerCase().indexOf(t.brand.toLowerCase())>-1?t.model:t.brand.toLowerCase()+BLANK_SPACE+t.model,device_brand:t.brand,channel:t.brand.toLowerCase(),device_manufacturer:t.manufacturer,device_manuid:t.model.toLowerCase().indexOf(t.brand.toLowerCase())>-1?t.model:t.brand.toLowerCase()+BLANK_SPACE+t.model,device_name:t.product.toLowerCase().indexOf(t.brand.toLowerCase())>-1?t.product:t.brand.toLowerCase()+BLANK_SPACE+t.product,os_version:t.osVersionName,resolution:a,language:t.language,display_name:t.name,idmd5:UmengUtils.MD5(n),platform:"quickapp",pro_ver:"1"}}else i={app_version:s.appInfo.versionName,version_code:s.appInfo.versionCode,device_type:"Phone",package_name:s.appInfo.packageName,sdk_type:"Android",os:"Android",sdk_version:constants.SDK_VERSION,appkey:s.appkey,idmd5:UmengUtils.MD5(n),platform:"quickapp",pro_ver:"1"};switch(e){case MOBILE_NETWORK_4G:i.access_subtype="LTE",i.access="2G/3G";break;case MOBILE_NETWORK_3G:i.access_subtype="CDMA",i.access="2G/3G";break;case MOBILE_NETWORK_2G:i.access_subtype="GRPS",i.access="2G/3G";break;default:i.access=e,delete i.access_subtype}return i}let s=null,a=!1;require("@system.network");return{getInstance(){return s||(s=t()),s}}}();Looper.prototype={prepare(t){this.queueObject=t,this.isRunning=!1,this.isForceStop=!1},loop(){if(!this.isForceStop&&this.queueObject&&!this.isRunning)for(this.isRunning=!0;this.isRunning;){if(!this.queueObject.isCanPop()){this.isRunning=!1;break}try{this.queueObject.dispatchMessage()}catch(t){}}},wait(){this.isRunning=!1},forceStop(){this.isForceStop=!0},cancelForceStop(){this.isForceStop=!1,this.loop()}};const RequestQueue=function(){function t(t){return!!t&&(g.unshift(t),u.loop(),!0)}function n(){if(g.length>0)return g.pop();const t=_.length;return t>0?(1===t&&RequestHelper.getInstance().clearNoSendDatas(),_.pop()):null}function e(t,n){const e=setTimeout(function(){i(t)},3e4),o={key:t,timeOutFun:e,isExe:!1};S.push(o),n(function(t){i(t)})}function i(t){for(let n=S.length-1;n>=0;n--){const e=S[n];if(e.key===t){if(!e.isExe){e.isExe=!0;const t=e.timeOutFun;t&&clearTimeout(t),o(),S.splice(n,1)}break}}}function o(){--f<=l&&u.loop()}function s(t){const n=S.length,e=t.md5Key;for(let t=n-1;t>=0;t--){const n=S[t];if(n.key===e)return o(),!0}return!1}function a(){RequestHelper.getInstance().onNoSendDatasListener(function(t){if(t&&0!==t.length){for(let n in t){const e={md5Key:t[n],type:"second"};_.push(e)}u.loop()}})}function r(){return a(),{handleMessage(n,e){n&&"second"===n.type&&o(),n&&n.data&&(n.executeFunction=e,t(n))},dispatchMessage(){if(f>l)return void u.wait();f++;const t=n();if(!s(t)){const n=t.executeFunction;t.data?e(t.md5Key,n):RequestHelper.getInstance().send(t),this.isCanPop()||u.wait()}},isCanPop(){return g.length>0||_.length>0}}}let c,u,g=[],_=[];const l=3;let f=1;const S=[];return{getInstance(){return c||(c=r(),(u=new Looper).prepare(c)),c}}}(),StoreQueue=function(){function t(t){if(!t)return!1;const n={key:t,type:l};return u.unshift(n),c.loop(),!0}function n(){if(u.length>0)return u.pop();const t=g.length;if(t>0){const n=g.pop();return 0===t&&e(),n}return e(),null}function e(){S||(S=!0,StorageUtil.getData(constants.KEY_NO_SEND_REQUEST_KEYS,function(t){if(S=!1,t){const n=UmengUtils.stringToArray(t);for(let t in n){const e=n[t];StorageUtil.getData(e,function(t){if(!t||'""'===t){const t={key:e,type:f};g.push(t)}g.length>0&&c.loop()})}}},function(t){S=!1}))}function i(t){StorageUtil.getData(constants.KEY_NO_SEND_REQUEST_KEYS,function(n){(n=n?JSON.parse(n):[]).push(t),StorageUtil.putData(constants.KEY_NO_SEND_REQUEST_KEYS,UmengUtils.toString(n),function(n){s(t)},function(n,e){s(t)})},function(n,e){s(t)})}function o(t){StorageUtil.getData(constants.KEY_NO_SEND_REQUEST_KEYS,function(n){if(!n)return void s(t);n=UmengUtils.stringToArray(n);for(let e in n){const i=n[e];if(i===t){n.splice(e,1);break}}StorageUtil.putData(constants.KEY_NO_SEND_REQUEST_KEYS,UmengUtils.toString(n),function(n){s(t)},function(n,e){s(t)})},function(n,e){s(t)})}function s(t){--E<=_&&c.loop()}function a(){return e(),{handleMessage(n){n?t(n):e()},dispatchMessage(){if(E>_)return void c.wait();E++;let t=n();if(!t||null===t)return void s();const e=t.key;t.type===l?i(e):o(e),this.isCanPop()||c.wait()},isCanPop(){return u.length>0||g.length>0}}}let r,c,u=[],g=[];const _=1,l="write",f="delete";let S=!1,E=1;return{getInstance(){return r||(r=a(),(c=new Looper).prepare(r)),r}}}(),$UMENG_KEY_IMPRINT$$1="umeng_key_imprint";let noSendRequestKeys=[];const RequestHelper=function(){function t(){var t=[].concat(Session.getInstance().getSessions());if(t&&0!==t.length)return Session.getInstance().clearSessions(),t}function n(){var t=[].concat(Session.getInstance().getHalfSessions());if(t&&0!==t.length)return Session.getInstance().clearHalfSession(),t}function e(t){StorageUtil.deleteData(t,function(t){t&&StoreQueue.getInstance().handleMessage(null)})}function i(t,n,i,o){if(!t||'""'===t)return void(i&&i(n));const s=constants.RELEASE_URL;fetch.fetch({url:s,method:"POST",data:UmengUtils.encode(t),header:{"Content-Type":"quickapp/json","Msg-Type":"quickapp/json"},success:function(t){if(200===t.code){e(n),o&&o(n);try{let n=UmengUtils.toObject(t.data),e=n.imprint;StorageUtil.putData($UMENG_KEY_IMPRINT$$1,e),Header.getInstance().addHeaderAttr("imprint",e)}catch(t){}}},fail:function(t,n){},complete:function(){i&&i(n)}})}function o(t,n){const e=UmengUtils.toString(n);var i=null;switch(t){case constants.REQUEST_TYPE_SESSION_HALF:i=constants.KEY_HALF_SESSION_PREFIX;break;case constants.REQUEST_TYPE_SESSION_CLOSE:i=constants.KEY_CLOSE_SESSION_PREFIX;break;case constants.REQUEST_TYPE_EVENT:i=constants.KEY_EVENT_PREFIX}const o=i+UmengUtils.MD5(e);return StorageUtil.putData(o,e),StoreQueue.getInstance().handleMessage(o),0===noSendRequestKeys.length&&StorageUtil.getData(constants.KEY_NO_SEND_REQUEST_KEYS,function(t){if(t){const n=UmengUtils.stringToArray(t);0===noSendRequestKeys.length&&(noSendRequestKeys=n,r&&r(noSendRequestKeys))}}),o}function s(){return{paramsIsValid(t){return-1!==[constants.REQUEST_TYPE_SESSION_HALF,constants.REQUEST_TYPE_SESSION_CLOSE,constants.REQUEST_TYPE_EVENT].indexOf(t)},buildSendContent(e,i){var s={header:Header.getInstance().getHeader(e),analytics:null};switch(e){case constants.REQUEST_TYPE_SESSION_HALF:var a=n();if(!a)break;s.analytics={sessions:a};break;case constants.REQUEST_TYPE_SESSION_CLOSE:var r=t();if(!r)break;s.analytics={sessions:r};break;case constants.REQUEST_TYPE_EVENT:i&&i.length>0&&(s.analytics={ekv:i})}var c="";return s.analytics&&(c=o(e,s)),{data:s,md5Key:c}},send(t,n){let e=t.md5Key;e&&("second"===t.type?StorageUtil.getData(e,function(e){t.data=UmengUtils.toObject(e),t.data||n&&n(),RequestQueue.getInstance().handleMessage(t,function(e){i(UmengUtils.toString(t.data),t.md5Key,e,n)})}):RequestQueue.getInstance().handleMessage(t,function(e){i(UmengUtils.toString(t.data),t.md5Key,e,n)}))},getNoSendRequestKeys(){return noSendRequestKeys},onNoSendDatasListener(t){r=t},clearNoSendDatas(){noSendRequestKeys.splice(0,noSendRequestKeys.length),noSendRequestKeys=[]}}}var a,r;return{getInstance(){return a||(a=s()),a}}}(),EventStoreQueue=function(){function t(t){if(t){if(!Session.getInstance().getCurrentSessionId())return void U.unshift(t);h.unshift(t),h.length>=l&&S.loop()}}function n(){return h.length<l?null:h.splice(0,l)}function e(){p&&p.length>0&&a(function(t){for(var n in p)try{p[n](t)}catch(t){}}),--E<1&&(E=1),E<=f&&S.loop()}function i(t,n){StorageUtil.putData(u,n,function(){StorageUtil.putData(g,UmengUtils.toString(t),function(){e()},function(){e()})},function(){e()})}function o(t,n){t&&(p[t]=n)}function s(t){t&&delete p[t]}function a(t){StorageUtil.getData(g,function(n){StorageUtil.deleteData(g,function(){t(UmengUtils.stringToArray(n)),S.cancelForceStop()})},function(){t([]),S.cancelForceStop()})}function r(t,n){let e,i=Session.getInstance().getCurrentSessionId(),o=-1;for(let n in t){let s=t[n];if(e=s[i]){o=n;break}}return-1===o&&(e=[]),e=e.concat(n),-1===o?t.push({[i]:e}):t[o][i]=e,t}function c(){return{saveEkvData(n){t(n)},readEkvDatas(t){t&&(S.forceStop(),E<=f?a(function(n){t(n),S.cancelForceStop()}):o("readEkvDatas",function(n){t(n),s("readEkvDatas"),S.cancelForceStop()}))},handlerNoSessionEkvDatas(){if(U&&U.length>0){Log.d("no sessionId event is "+JSON.stringify(U));for(let t in U)this.saveEkvData(U[t]);U.splice(0,U.length)}},quitHandler(){0!==h.length&&(S.forceStop(),E<=f?StorageUtil.getData(g,function(t){let n=r(UmengUtils.stringToArray(t),h);StorageUtil.putData(g,UmengUtils.toString(n)),h.splice(0,h.length),S.cancelForceStop()},function(){S.cancelForceStop()}):o("quitHandler",function(t){let n=UmengUtils.toString(r(t,h));StorageUtil.putData(g,n),h.splice(0,h.length),s("quitHandler"),S.cancelForceStop()}))},dispatchMessage(){if(E>f)return void S.wait();E++;const t=n();if(!t||0===t.length)return void e();StorageUtil.getData(u,function(n){n||(n=0),n>=_+t.length?e():StorageUtil.getData(g,function(e){i(r(UmengUtils.stringToArray(e),t),Number(n)+Number(t.length))},function(t,n){e()})},function(t,n){e()})},isCanPop(){return h.length>=l}}}const u="umeng_ekv_count_key",g="umeng_key_ekvs",_=1e4,l=5,f=1;var S,E=1,d=null,p={},h=[],U=[];return{getInstance:function(){return d||(d=new c,(S=new Looper).prepare(d)),d}}}();var Request={send:send};const EventController=function(){function t(t,n){var e={id:t,ts:Date.now()};if(n)switch(typeof n){case"string":e[t]=n;break;case"object":for(var i in n)e[i]=n[i]}return e}function n(){return{addEvent(n,e){var i=t(n,e);EventStoreQueue.getInstance().saveEkvData(i)},handlerNoSessionEkvDatas(){EventStoreQueue.getInstance().handlerNoSessionEkvDatas()},quitHandler(){EventStoreQueue.getInstance().quitHandler()}}}var e;return{getInstance(){return e||(e=n()),e}}}(),KEY_PRE_PAGE="umeng_page_";PageController.prototype={addCurrentPage(t){this._currentPage={ts:Date.now(),page_name:DeviceUtil.getPageName()},this.pageObject=t},savePage(t,n){if(t&&n&&this._currentPage.page_name&&n===this.pageObject){var e=Date.now()-this._currentPage.ts;this._currentPage.duration=Math.abs(e),this._pagelist=this._pagelist.concat(this._currentPage),this._currentPage={},this.pageObject={},this.saveStroragePages(t)}},saveStroragePages(t){t&&this._pagelist.length>0&&this.updateStorage(KEY_PRE_PAGE+t,this._pagelist)},getPages(t,n){let e=this;StorageUtil.getData(KEY_PRE_PAGE+t,function(i){var o=UmengUtils.stringToArray(i).concat(e._pagelist);e.clear(t),n&&n(o)},function(t,e){n&&n(null)})},updateStorage(t,n){if(n&&0!==n.length){let e=this;StorageUtil.getData(t,function(i){var o=UmengUtils.stringToArray(i).concat(n);StorageUtil.putData(t,UmengUtils.toString(o),function(t){e._pagelist=[]})})}},clear(t){StorageUtil.deleteData(KEY_PRE_PAGE+t),this._pagelist=[]}};let inited=!1;UmengAnalysisLib.prototype={init(t){if(!inited){try{this.appkey=t.$data.umeng_appkey}catch(t){}if(!this.appkey)return inited=!1,void console.error("please set umeng_appkey : [manifest.json --\x3e config:{data:{umeng_appkey: xxx}}]");inited=!0,Header.getInstance().init(this.appkey);var n=this;Session.getInstance().setOnSessionListener(function(t){return{pages(e){n.pageController.getPages(t,e)},generateSessionAfterHandler(t){EventController.getInstance().handlerNoSessionEkvDatas(),sendDatas()}}}),StorageUtil.getData(constants.APP_FIRST_OPEN_FLAG,function(t){0==t.length&&StorageUtil.putData(constants.APP_FIRST_OPEN_FLAG,"true")})}},resume(t){isInit()&&t&&(this.pageController.addCurrentPage(t),Session.getInstance().init(this.appkey))},pause(t){isInit()&&t&&(this.pageController.savePage(Session.getInstance().getCurrentSessionId(),t),Session.getInstance().endSession(),EventController.getInstance().quitHandler())},trackEvent(t,n){if(isInit())return UmengUtils.checkId(t)?n&&!UmengUtils.checkAttr(n)?(console.error("error-----please check trackEvent attr. attr should be 'String' or 'Object'(not include 'Array')"),!1):(EventController.getInstance().addEvent(t,n),!0):(console.error("error-----please check trackEvent id. id should be 'String' and not null"),!1)}};const umeng_stat_global=Object.getPrototypeOf(global)||global,UmengAnalysis={_analysisLib:new UmengAnalysisLib,init(t){this._analysisLib.init(t)},resume(t){this._analysisLib.resume(t)},pause(t){this._analysisLib.pause(t)},trackEvent(t,n){this._analysisLib.trackEvent(t,n)}};!function(){umeng_stat_global&&(umeng_stat_global.$umeng_stat=UmengAnalysis,umeng_stat_global.Page=Page)}();export default UmengAnalysis;
//# sourceMappingURL=umenganalysis.es.min.js.map
